<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.&nbsp;Counter&#20043;Rife&#29256;</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="Java&#32593;&#32476;&#31243;&#24207;&#21592;&#30475;Continuation"><link rel="up" href="ch05.html" title="Chapter&nbsp;5.&nbsp;RIFE&#31616;&#20171;"><link rel="prev" href="ch05s02.html" title="2.&nbsp;&#23433;&#35013;&#21644;&#21551;&#21160;Rife"><link rel="next" href="ch05s04.html" title="4.&nbsp;&#29468;&#25968;&#23383;&#20043;Rife&#29256;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.&nbsp;Counter&#20043;Rife&#29256;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s02.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;5.&nbsp;RIFE&#31616;&#20171;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch05s04.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e675"></a>3.&nbsp;Counter&#20043;Rife&#29256;</h2></div></div></div><p>&#22312;&#20570;&#20219;&#20309;&#24320;&#21457;&#20043;&#21069;&#65292;&#25105;&#20204;&#39318;&#20808;&#20171;&#32461;&#20960;&#20010;Rife&#37324;&#30340;&#37325;&#35201;&#30446;&#24405;&#21644;&#25991;&#20214;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>src/sites/pub.xml&#65306;Rife&#20013;&#27599;&#20010;&#39033;&#30446;&#26159;&#30001;&#33509;&#24178;&#20010;site&#32452;&#25104;&#30340;&#65292;rife-jumpstart&#20013;&#23450;&#20041;&#20102;&#19968;&#20010;pub site&#65292;&#21644;&#19968;&#20010;&#29992;&#26469;&#20570;admin&#31649;&#29702;&#30340;admin site&#12290;&#25105;&#20204;&#30340;&#20363;&#23376;&#20013;&#21482;&#20250;&#29992;&#21040;pub.xml&#12290;&#36825;&#20004;&#20010;site&#37117;&#26159;&#22312;src/sites/main.xml&#20013;&#23450;&#20041;&#30340;&#12290;</p></li><li><p>&#22914;&#26524;&#25105;&#20204;&#25171;&#24320;pub.xml&#65292;&#25105;&#20204;&#23601;&#20250;&#30475;&#21040;&#20854;&#20013;element&#30340;&#23450;&#20041;&#12290;Rife&#20013;&#35201;&#29992;&#21040;&#30340;&#27599;&#19968;&#20010;&#37096;&#20214;&#65288;Element&#31867;&#65289;&#37117;&#35201;&#26377;&#19968;&#20010;element&#23450;&#20041;&#12290;&#25105;&#20204;&#21487;&#20197;&#32473;&#35813;element&#19968;&#20010;URL&#65292;&#21542;&#21017;&#29992;&#25143;&#19981;&#33021;&#30452;&#25509;&#35775;&#38382;&#35813;element&#12290;&#22823;&#37096;&#20998;element&#37117;&#20250;&#30001;&#19968;&#20010;&#31867;&#25903;&#25345;&#65292;&#36825;&#20123;&#31867;&#36890;&#24120;&#25918;&#22312;src/implementation&#25991;&#20214;&#22841;&#20013;&#12290;</p></li><li><p>src/java&#65306;&#21830;&#19994;&#25968;&#25454;&#21450;&#36923;&#36753;&#31867;&#22312;&#36825;&#20010;&#30446;&#24405;&#19979;&#12290;</p></li><li><p>src/template&#65306;template&#30446;&#24405;&#12290;&#25105;&#20204;&#22312;&#31243;&#24207;&#20013;&#35843;&#29992;&#8220;counter.display&#8221;&#26102;&#65292;Rife&#20250;&#23558;&#20043;&#32763;&#35793;&#20026;src/template/counter/display.html&#12290;</p></li></ul></div><p>&#26082;&#28982;&#25105;&#20204;&#26159;&#35201;&#20889;counter&#65292;&#37027;&#20040;&#25105;&#20204;&#20808;&#20889;&#19968;&#20010;counter&#30340;element&#23450;&#20041;&#12290;&#20462;&#25913;src/sites/pub.xml&#22914;&#19979;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;site&gt;
  &lt;arrival destid="Counter"/&gt;
  &lt;element id="Counter"
           implementation="counter.CounterController"
           url="/counter"/&gt;
&lt;/site&gt;</pre><p>&#36825;&#37324;&#25105;&#20204;&#29992;arrival&#22768;&#26126;&#20102;Counter element&#20026;&#39318;&#39029;&#12290;&#25509;&#19979;&#26469;&#25105;&#20204;&#22312;src/implementation&#20013;&#21019;&#24314;counter.CounterController&#31867;&#20197;&#23454;&#29616;&#35813;element&#12290;</p><pre class="programlisting">package counter;

import com.uwyn.rife.engine.Element;
import com.uwyn.rife.template.Template;

public class CounterController extends Element {
    private int count = 0;
    private Template template;
    
    public void initialize() {
        template = getHtmlTemplate("counter.display");
    }
    
    public void processElement() {
        print(template);
    }
}</pre><p>&#19978;&#38754;&#20171;&#32461;&#36807;&#65292;count.display&#34987;&#32763;&#35793;&#25104;src/template/counter/display.html&#65292;&#25152;&#20197;&#25105;&#20204;&#22312;src/template&#19979;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#25991;&#20214;&#22841;counter&#65292;&#24182;&#22312;&#37324;&#38754;&#26032;&#24314;&#19968;&#20010;&#25991;&#20214;display.html&#12290;&#20854;&#20869;&#23481;&#22914;&#19979;&#65306;</p><pre class="programlisting">&lt;!--I 'common.blueprint'/--&gt;
&lt;!--I 'common.error_messages'/--&gt;
&lt;!--BV 'window_title'--&gt;Counter Application&lt;!--/BV--&gt;
&lt;!--BV 'content'--&gt;
    &lt;div class="content"&gt;
        &lt;h1&gt;Counter Application&lt;/h1&gt;
        &lt;p&gt;Welcome to the counter application!&lt;/p&gt;
    &lt;/div&gt;
&lt;!--/BV--&gt;</pre><p>Rife&#27169;&#29256;&#30340;&#35821;&#27861;&#30475;&#36215;&#26469;&#30456;&#24403;&#22855;&#24618;&#65292;&#36825;&#37324;&#25105;&#31245;&#24494;&#35299;&#37322;&#19968;&#19979;&#12290;Rife&#27169;&#29256;&#37324;&#26377;&#20004;&#20010;&#24456;&#37325;&#35201;&#30340;tag&#65292;&#19968;&#20010;&#26159;Block&#65292;&#29992;B&#34920;&#31034;&#65307;&#21478;&#19968;&#20010;&#26159;Value&#65292;&#29992;V&#34920;&#31034;&#12290;&#31616;&#21333;&#30340;&#35828;&#65292;&#23454;&#29616;element&#30340;&#31867;&#21487;&#20197;&#35835;&#27169;&#29256;&#37324;&#30340;Block&#20540;&#65292;&#21487;&#20197;&#20889;&#27169;&#29256;&#37324;&#30340;Value&#20540;&#12290;B&#21644;V&#30340;&#36215;&#22987;&#20013;&#27490;&#19982;XML&#31867;&#20284;&#65292;&#19981;&#36807;&#23427;&#25913;&#29992;&#25152;&#22312;&#25991;&#20214;&#26684;&#24335;&#30340;&#27880;&#37322;&#26684;&#24335;&#21462;&#20195;&#8220;&lt;&#8221;&#21644;&#8220;&gt;&#8221;&#12290;&#25152;&#20197;&#22312;HTML&#27169;&#29256;&#25991;&#20214;&#20013;&#65292;&lt;!--B &#8216;content&#8217;--&gt;something here&lt;!--/B--&gt;&#23450;&#20041;&#20102;&#19968;&#20010;Block&#65292;&lt;!--B &#8216;content&#8217;/--&gt;&#21017;&#23450;&#20041;&#20102;&#19968;&#20010;&#31354;&#30340;Block&#12290;</p><p>&#19978;&#38754;&#27169;&#29256;&#20013;&#30340;content&#20540;&#23558;&#20250;&#20986;&#29616;&#22312;HTML BODY&#20013;&#65292;window_title&#20540;&#21017;&#23558;&#25104;&#20026;HTML&#26631;&#39064;&#12290;&#20043;&#25152;&#20197;&#20250;&#20351;&#29992;&#36825;&#20004;&#20010;&#20540;&#30340;&#20855;&#20307;&#23450;&#20041;&#22312;src/template/common/blueprint&#27169;&#29256;&#20013;&#65292;&#35813;&#27169;&#29256;&#20063;&#21253;&#21547;&#20102;&#26631;&#20934;&#30340;HTML&#24320;&#22836;&#21644;&#32467;&#23614;&#65292;&#26377;&#20852;&#36259;&#30340;&#35835;&#32773;&#21487;&#20197;&#30475;&#30475;&#20854;&#20869;&#23481;&#12290;</p><p>&#22909;&#20102;&#65292;&#20445;&#23384;&#25152;&#26377;&#25991;&#20214;&#65292;&#19981;&#38656;&#35201;&#37325;&#26032;&#21551;&#21160;&#26381;&#21153;&#22120;&#65292;&#21047;&#26032;&#27983;&#35272;&#22120;&#25105;&#20204;&#23601;&#33021;&#30475;&#35265;&#27169;&#29256;&#27491;&#30830;&#26174;&#31034;&#65306;</p><div class="screenshot"><div class="mediaobject"><img src="resources/rife-counter-welcome.png"></div></div><p>&#30830;&#35748;&#20102;&#36825;&#20123;&#27493;&#39588;&#37117;&#20570;&#23545;&#20102;&#20043;&#21518;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#26469;&#23454;&#29616;counter&#31243;&#24207;&#20102;&#12290;&#39318;&#20808;&#25105;&#20204;&#35201;&#32473;pub.xml&#37324;&#30340;counter element&#22686;&#21152;&#20004;&#20010;submission&#65292;&#36825;&#26102;&#22312;Rife&#20013;&#23450;&#20041;element&#8220;&#20837;&#21475;&#8221;&#30340;&#21150;&#27861;&#12290;&#20462;&#25913;&#21518;&#30340;pub.xml&#22914;&#19979;&#25152;&#31034;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE site SYSTEM "/dtd/site.dtd"&gt;
&lt;site&gt;
  &lt;arrival destid="Counter"/&gt;
  &lt;element id="Counter"
           implementation="counter.CounterController"
           url="/counter"&gt;
    &lt;submission name="increase"/&gt;
    &lt;submission name="decrease"/&gt;
  &lt;/element&gt;
&lt;/site&gt;</pre><p>&#28982;&#21518;&#25105;&#20204;&#22312;counter.display&#27169;&#29256;&#20013;&#23450;&#20041;counter&#20540;&#20197;&#21450;&#20004;&#20010;&#38142;&#25509;&#24212;&#35813;&#26174;&#31034;&#22312;&#21738;&#37324;&#12290;</p><pre class="programlisting">&lt;!--I 'common.blueprint'/--&gt;
&lt;!--I 'common.error_messages'/--&gt;
&lt;!--BV 'window_title'--&gt;Counter Application&lt;!--/BV--&gt;
&lt;!--BV 'content'--&gt;
    &lt;div class="content"&gt;
        &lt;h1&gt;Counter Application&lt;/h1&gt;
        &lt;p&gt;&lt;!--V 'counter'/--&gt;&lt;/p&gt;
        &lt;a href="[!V &#8216;SUBMISSION:QUERY:increase&#8217;/]"&gt;++&lt;/a&gt;
        &lt;a href="[!V &#8216;SUBMISSION:QUERY:decrease&#8217;/]"&gt;--&lt;/a&gt;
    &lt;/div&gt;
&lt;!--/BV--&gt;</pre><p>&#19978;&#38754;&#23450;&#20041;&#20102;&#19968;&#20010;&#21483;counter&#30340;Value&#65292;&#35813;Value&#23558;&#30001;&#25105;&#20204;&#22312;CounterController&#31867;&#20013;&#25351;&#23450;&#12290;&#21478;&#22806;&#65292;&#25105;&#20204;&#30475;&#21040;&#21478;&#19968;&#31181;&#22768;&#26126;Value&#30340;&#26041;&#27861;&#65292;[!V/]&#65292;&#23427;&#30340;&#32467;&#26500;&#21644;&lt;!--V/--&gt;&#26159;&#19968;&#26679;&#30340;&#65292;&#20294;&#26159;&#23427;&#29992;&#22312;HTML&#24341;&#21495;&#20043;&#38388;&#12290;Value&#21517;SUBMISSION:QUERY:xxx&#26159;&#26377;&#24847;&#20041;&#30340;&#65292;&#23427;&#20250;&#29983;&#25104;&#19968;&#20010;&#25351;&#21521;&#35813;submission&#30340;URL&#12290;Increase&#21644;decrease&#20004;&#20010;submission&#21017;&#26159;&#25105;&#20204;&#21018;&#25165;&#22312;pub.xml&#37324;&#23450;&#20041;&#30340;&#12290;</p><p>&#22909;&#65292;&#29616;&#22312;&#20934;&#22791;&#24037;&#20316;&#37117;&#20570;&#22909;&#20102;&#65292;&#25105;&#20204;&#26469;&#30475;CounterController&#22914;&#20309;&#29992;continuation&#23454;&#29616;counter&#12290;&#20195;&#30721;&#22914;&#19979;&#65306;</p><pre class="programlisting">package counter;

import com.uwyn.rife.engine.Element;
import com.uwyn.rife.template.Template;

public class CounterController extends Element {
    private int count = 0;
    private Template template;
    
    public void initialize() {
        template = getHtmlTemplate("counter.display");
    }
    
    public void processElement() {
        while(true) {
            template.setValue("counter", count);
            print(template);
            pause();
            
            if (hasSubmission("increase"))
                count++;
            if (hasSubmission("decrease"))
                count--;
        }
    }
}</pre><p>&#27880;&#24847;&#21040;&#25105;&#20204;&#22312;initialize()&#37324;&#35774;&#32622;&#27169;&#29256;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;private Template template = getHtmlTemplate(&#8220;counter.display&#8221;)&#12290;&#36825;&#24456;&#37325;&#35201;&#65292;&#22240;&#20026;initialize()&#20989;&#25968;&#20250;&#22312;&#19968;&#20010;&#37197;&#21046;&#22909;&#30340;&#29615;&#22659;&#20013;&#36816;&#34892;&#12290;&#19981;&#36807;&#25105;&#20204;&#19981;&#33021;&#25226;count = 0&#25918;&#22312;initialize()&#20013;&#65292;&#21542;&#21017;&#27599;&#27425;&#39029;&#38754;&#35843;&#29992;&#26102;count = 0&#37117;&#20250;&#25191;&#34892;&#12290;</p><p>&#22312;processElement()&#20989;&#25968;&#37324;&#25105;&#20204;&#29992;&#21040;&#19968;&#20010;&#27515;&#24490;&#29615;&#12290;&#22312;&#36825;&#37324;&#25105;&#20204;&#25226;&#27169;&#29256;&#20013;counter&#36825;&#20010;Value&#23450;&#25104;count&#30340;&#20540;&#65292;&#36755;&#20986;&#27169;&#29256;&#65292;&#28982;&#21518;&#25105;&#20204;pause()&#12290;&#36825;&#26102;&#25105;&#20204;&#30340;&#31243;&#24207;&#20250;&#26242;&#20572;&#65292;&#31561;&#24453;&#29992;&#25143;&#36755;&#20837;&#12290;&#29992;&#25143;&#36755;&#20837;&#23436;&#25104;&#21518;&#25105;&#20204;&#26816;&#26597;&#26159;&#21542;&#26377;submission&#65292;&#24182;&#36827;&#34892;&#30456;&#24212;&#30340;&#25805;&#20316;&#12290;&#20445;&#23384;&#25152;&#26377;&#25991;&#20214;&#65292;&#24182;&#27983;&#35272;<code class="uri">http://localhost:8080/</code>&#65292;&#25105;&#20204;&#20250;&#30475;&#21040;&#19979;&#38754;&#30340;&#39029;&#38754;&#12290;&#24744;&#21487;&#20197;&#35797;&#35797;&#21518;&#36864;&#38190;&#65292;&#33258;&#24049;&#39564;&#35777;&#19968;&#19979;Rife&#23545;&#21518;&#36864;&#30340;&#22788;&#29702;&#12290;</p><div class="screenshot"><div class="mediaobject"><img src="resources/rife-counter.png"></div></div><p>&#24744;&#24212;&#35813;&#27880;&#24847;&#21040;&#20102;&#65292;&#34429;&#28982;&#20004;&#32773;&#37117;&#20351;&#29992;continuation&#65292;&#20294;&#26159;Rife&#30340;&#20570;&#27861;&#21644;Seaside&#30340;&#30053;&#26377;&#19981;&#21516;&#12290;&#26368;&#20027;&#35201;&#30340;&#21306;&#21035;&#22312;&#20110;&#65292;Rife&#20013;&#30340;&#27169;&#29256;&#36755;&#20986;&#26159;&#25105;&#20204;&#25163;&#21160;&#35843;&#29992;&#30340;&#65292;&#32780;Seaside&#37324;renderContentOn&#26041;&#27861;&#26159;Seaside&#33258;&#21160;&#35843;&#29992;&#30340;&#12290;Rife&#29992;pause()&#30340;&#20570;&#27861;&#38750;&#24120;&#30452;&#35266;&#65292;&#20294;&#26159;&#20854;&#32570;&#38519;&#26159;&#26080;&#27861;&#25903;&#25345;Seaside&#30340;multi&#20363;&#23376;&#20013;&#25152;&#23637;&#31034;&#30340;&#8220;&#22810;&#27969;&#31243;&#25511;&#21046;&#8221;&#12290;&#22312;multi&#20013;&#26377;&#22810;&#20010;&#29420;&#31435;&#30340;&#27969;&#31243;&#65288;&#20363;&#23376;&#20013;&#26159;&#20960;&#20010;WACounter&#65289;&#22312;&#21516;&#26102;&#25191;&#34892;&#65292;&#27599;&#27425;&#35831;&#27714;&#26102;&#26377;&#19968;&#20010;&#27969;&#31243;&#20250;&#20570;&#20986;&#21453;&#24212;&#65292;&#20294;&#26159;&#20026;&#20102;&#29983;&#25104;&#25972;&#20010;&#39029;&#38754;&#65292;Seaside&#38656;&#35201;&#23545;&#27599;&#20010;WAComponent&#35843;&#29992;renderContentOn&#26041;&#27861;&#65292;&#32780;&#36825;&#22312;&#25163;&#21160;&#36755;&#20986;&#27169;&#29256;&#30340;Rife&#20013;&#26159;&#19981;&#21487;&#33021;&#30340;&#12290;</p><p>&#21478;&#22806;&#65292;Rife&#21463;&#21040;Java&#35821;&#35328;&#30340;&#38480;&#21046;&#65292;&#19981;&#21487;&#33021;&#29983;&#25104;&#30452;&#25509;&#35843;&#29992;&#20195;&#30721;&#30340;&#38142;&#25509;&#65292;&#32780;&#36825;&#31181;&#38142;&#25509;&#27491;&#26159;Seaside&#30340;&#21334;&#28857;&#20043;&#19968;&#12290;</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s02.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch05.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch05s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.&nbsp;&#23433;&#35013;&#21644;&#21551;&#21160;Rife&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;4.&nbsp;&#29468;&#25968;&#23383;&#20043;Rife&#29256;</td></tr></table></div></body></html>