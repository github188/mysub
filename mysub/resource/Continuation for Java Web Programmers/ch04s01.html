<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>1.&nbsp;Continuation&#30340;&#24120;&#35268;&#23454;&#29616;&#26041;&#27861;</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="Java&#32593;&#32476;&#31243;&#24207;&#21592;&#30475;Continuation"><link rel="up" href="ch04.html" title="Chapter&nbsp;4.&nbsp;Continuation&#30340;&#23454;&#29616;"><link rel="prev" href="ch04.html" title="Chapter&nbsp;4.&nbsp;Continuation&#30340;&#23454;&#29616;"><link rel="next" href="ch04s02.html" title="2.&nbsp;&#22312;Java&#19978;&#23454;&#29616;Continuation&#65306;&#22522;&#20110;stack&#27861;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1.&nbsp;Continuation&#30340;&#24120;&#35268;&#23454;&#29616;&#26041;&#27861;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;4.&nbsp;Continuation&#30340;&#23454;&#29616;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch04s02.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e510"></a>1.&nbsp;Continuation&#30340;&#24120;&#35268;&#23454;&#29616;&#26041;&#27861;</h2></div></div></div><p>&#34429;&#28982;&#22823;&#22810;&#25968;&#31243;&#24207;&#21592;&#37117;&#27809;&#26377;&#22826;&#22810;&#25509;&#35302;&#36807;continuation&#65292;&#20294;&#26159;continuation&#20854;&#23454;&#26159;&#19968;&#20010;&#24456;&#37325;&#35201;&#30340;&#30740;&#31350;&#39046;&#22495;&#12290;&#22914;&#26412;&#25991;&#24320;&#22836;&#25152;&#35828;&#65292;&#30740;&#31350;compiler&#20248;&#21270;&#25216;&#26415;&#30340;&#8220;&#31185;&#23398;&#24618;&#20154;&#8221;&#20204;&#24819;&#20986;&#20102;continuation&#21508;&#31181;&#21508;&#26679;&#30340;&#23454;&#29616;&#26041;&#27861;&#65292;&#36825;&#37324;&#25105;&#20204;&#21482;&#20171;&#32461;&#20854;&#20013;&#20004;&#31181;&#26368;&#22522;&#26412;&#30340;&#65292;&#22522;&#20110;heap&#21644;&#22522;&#20110;stack&#12290;</p><p>&#39318;&#20808;&#25105;&#20204;&#38656;&#35201;&#24819;&#24819;&#65292;&#20174;&#35821;&#35328;&#23454;&#29616;&#30340;&#35282;&#24230;&#35762;&#65292;continuation&#21040;&#24213;&#26159;&#20160;&#20040;&#65311;&#23427;&#26159;&#31243;&#24207;&#30340;&#19968;&#20010;&#29366;&#24577;&#12290;&#31243;&#24207;&#30340;&#29366;&#24577;&#21253;&#25324;&#20160;&#20040;&#65311;&#31616;&#21333;&#22320;&#35762;&#65292;&#31243;&#24207;&#30340;&#29366;&#24577;&#26159;&#30001;stack&#21644;&#31243;&#24207;&#25351;&#38024;&#65288;program counter&#65289;&#32452;&#25104;&#30340;&#12290;&#26377;&#20102;&#31243;&#24207;&#25351;&#38024;&#65292;&#25105;&#20204;&#23601;&#30693;&#36947;&#31243;&#24207;&#36816;&#34892;&#21040;&#21738;&#37324;&#20102;&#65307;&#26377;&#20102;stack&#65292;&#25105;&#20204;&#23601;&#30693;&#36947;&#20989;&#25968;&#36820;&#22238;&#21435;&#21738;&#37324;&#65292;&#20197;&#21450;&#25152;&#26377;&#26377;&#25928;&#30340;&#26412;&#22320;&#21464;&#37327;&#30340;&#20540;&#12290;</p><p>&#31243;&#24207;&#25351;&#38024;&#21482;&#26159;&#19968;&#20010;&#20540;&#65292;&#22788;&#29702;&#36215;&#26469;&#38750;&#24120;&#31616;&#21333;&#12290;&#25903;&#25345;continuation&#26368;&#29305;&#21035;&#30340;&#22320;&#26041;&#21487;&#33021;&#23601;&#22312;&#20110;&#23545;stack&#30340;&#22788;&#29702;&#20102;&#12290;&#19968;&#20010;&#20856;&#22411;&#30340;C stack&#30001;&#33509;&#24178;stack frame&#32452;&#25104;&#65292;&#27599;&#20010;stack frame&#20445;&#23384;&#20102;&#19968;&#20010;&#20989;&#25968;&#19968;&#27425;&#35843;&#29992;&#30340;&#26412;&#22320;&#21464;&#37327;&#21644;&#23569;&#37327;&#21035;&#30340;&#20449;&#24687;&#12290;&#20989;&#25968;&#36820;&#22238;&#26102;&#20854;stack frame&#20174;stack&#19978;&#25910;&#22238;&#65292;&#36825;&#26102;&#27597;&#20989;&#25968;&#23601;&#20250;&#32487;&#32493;&#36816;&#34892;&#12290;</p><p>Stack&#26159;&#31867;&#20284;C&#21644;Java&#31561;&#35821;&#35328;&#30340;&#26680;&#24515;&#32467;&#26500;&#65292;&#19981;&#36807;&#23427;&#26159;&#22522;&#20110;&#36825;&#26679;&#19968;&#20010;&#20551;&#35774;&#30340;&#65292;&#37027;&#23601;&#26159;&#22312;&#20989;&#25968;&#36820;&#22238;&#21518;&#20854;&#26412;&#22320;&#21464;&#37327;&#19981;&#20250;&#20877;&#34987;&#29992;&#21040;&#12290;&#22312;C/Java&#20013;&#36825;&#26174;&#28982;&#26159;&#27809;&#38382;&#39064;&#30340;&#65292;&#19981;&#36807;&#22312;Ruby&#20013;&#21602;&#65311;</p><pre class="programlisting">def function
  i = 1
  puts i
  callcc { |cc| return cc }
  i += 1
  puts i
  exit
end

aCC = function
aCC.call</pre><p>&#19978;&#38754;&#26159;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340;continuation&#31243;&#24207;&#12290;&#25105;&#20204;&#35843;&#29992;function&#26102;&#65292;&#23427;&#20250;&#36755;&#20986;&#8220;1&#8221;&#65292;&#24182;&#22312;return cc&#22788;&#36820;&#22238;&#12290;&#35813;continuation&#32426;&#24405;&#22312;aCC&#20013;&#12290;&#28982;&#21518;&#25105;&#20204;&#35843;&#29992;aCC.call&#12290;&#36825;&#26102;&#25105;&#20204;&#21448;&#36339;&#22238;function&#24403;&#20013;&#65292;&#25226;i&#35774;&#20026;2&#65292;&#36755;&#20986;2&#24182;&#36864;&#20986;&#12290;</p><p>&#36825;&#20010;&#20363;&#23376;&#34429;&#28982;&#31616;&#21333;&#65292;&#20294;&#26159;&#23427;&#35828;&#26126;&#19968;&#20010;&#38382;&#39064;&#65292;&#24403;function&#22312;return cc&#22788;&#36820;&#22238;&#26102;&#25105;&#20204;&#19981;&#33021;&#31435;&#21051;&#22238;&#25910;&#26412;&#22320;&#21464;&#37327;i&#65292;&#22240;&#20026;&#25105;&#20204;&#20197;&#21518;&#36824;&#26377;&#21487;&#33021;&#20877;&#36820;&#22238;&#21040;&#35813;&#20989;&#25968;&#24403;&#20013;&#65292;&#24182;&#19988;&#20877;&#27425;&#29992;&#21040;i&#30340;&#20540;&#12290;&#36825;&#23601;&#26159;&#20026;&#20160;&#20040;&#22522;&#20110;&#22534;&#30340;&#35821;&#35328;&#65292;&#22914;Java&#65292;&#24456;&#38590;&#25903;&#25345;continuation&#12290;</p><p>&#22914;&#26524;&#29992;&#20256;&#32479;&#30340;stack&#19981;&#26041;&#20415;&#65292;&#37027;&#20040;&#33258;&#28982;&#30340;&#36873;&#25321;&#23601;&#26159;&#25226;stack frame&#25918;&#22312;heap&#20013;&#12290;&#65288;&#36825;&#20010;&#21517;&#31216;&#24456;&#26377;&#20123;&#22855;&#24618;&#65292;&#25105;&#20204;&#26159;&#19981;&#26159;&#24212;&#35813;&#25913;&#21483;heap frame&#21602;&#65311;&#65289;&#36825;&#27491;&#26159;&#22522;&#20110;heap&#30340;continuation&#26041;&#26696;&#30340;&#20570;&#27861;&#12290;&#22312;&#36825;&#31181;&#20570;&#27861;&#19979;&#65292;heap&#20013;&#20445;&#23384;&#30340;&#21508;&#20010;stack frame&#32452;&#25104;&#33509;&#24178;&#20010;&#36923;&#36753;&#19978;&#30340;stack&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#12290;&#19979;&#22270;&#20013;&#26377;&#20004;&#20010;&#36923;&#36753;stack&#65292;&#34013;&#33394;&#30340;&#26159;&#24403;&#21069;&#27491;&#22312;&#36816;&#34892;&#30340;stack&#65292;&#32418;&#33394;&#30340;&#21017;&#26159;aCC&#36825;&#20010;continuation&#20013;&#32426;&#24405;&#30340;stack&#12290;</p><div class="screenshot"><div class="mediaobject"><img src="resources/heap-based.png"></div></div><p>&#34394;&#25311;&#26426;&#27704;&#36828;&#20250;&#20445;&#25345;&#19968;&#20010;&#25351;&#38024;&#25351;&#21521;&#24403;&#21069;stack&#30340;&#39030;&#31471;&#65288;&#35813;&#25351;&#38024;&#20063;&#20445;&#35777;&#20173;&#22312;&#24403;&#21069;stack&#19978;&#30340;stack frame&#19981;&#20250;&#34987;&#22238;&#25910;&#65289;&#65292;&#20294;&#21516;&#26102;&#27599;&#20010;continuation&#65292;&#20363;&#22914;aCC&#65292;&#20063;&#20445;&#25345;&#20102;&#19968;&#20010;&#36923;&#36753;&#19978;&#30340;stack&#12290;&#24403;&#19968;&#20010;&#20989;&#25968;&#36820;&#22238;&#26102;&#65292;&#23427;&#30340;stack frame&#19981;&#20250;&#31435;&#21363;&#22238;&#25910;&#12290;&#19981;&#36807;&#65292;&#22914;&#26524;&#19968;&#20010;stack frame&#19981;&#22312;&#20219;&#20309;&#19968;&#20010;stack&#20013;&#65288;&#21253;&#25324;&#24403;&#21069;stack&#25110;&#20219;&#20309;&#19968;&#20010;continuation&#38656;&#35201;&#30340;stack&#65289;&#65292;&#37027;&#20040;&#22312;heap&#22403;&#22334;&#22238;&#25910;&#65288;garbage collection&#65289;&#26102;&#35813;stack frame&#23601;&#20250;&#33258;&#21160;&#34987;&#22238;&#25910;&#12290;&#20363;&#22914;&#19978;&#38754;&#65292;&#22914;&#26524;&#25105;&#20204;&#25226;aCC&#30340;&#20540;&#37325;&#23450;&#20026;NULL&#65292;&#37027;&#20040;&#32418;&#33394;&#21306;&#22495;&#30340;&#20004;&#20010;stack frame&#23601;&#20250;&#34987;&#22403;&#22334;&#22238;&#25910;&#25481;&#12290;</p><p>&#22522;&#20110;heap&#30340;&#35299;&#20915;&#26041;&#26696;&#26377;&#24456;&#22810;&#21464;&#31181;&#65292;&#20027;&#35201;&#21306;&#21035;&#22312;&#20110;&#38024;&#23545;&#36825;&#31181;&#20855;&#20307;&#24773;&#20917;&#20248;&#21270;&#22403;&#22334;&#22238;&#25910;&#25928;&#29575;&#65292;&#22312;&#36825;&#37324;&#25105;&#20204;&#23601;&#19981;&#35814;&#32454;&#20171;&#32461;&#20102;&#12290;&#19981;&#20171;&#24847;&#36861;&#38543;&#31185;&#23398;&#24618;&#20154;&#27493;&#20240;&#30340;&#35835;&#32773;&#21487;&#20197;&#33258;&#24049;&#23519;&#30475;&#30456;&#20851;&#25991;&#29486;&#12290;</p><p>&#29992;heap&#25903;&#25345;continuation&#36923;&#36753;&#19978;&#38750;&#24120;&#24178;&#20928;&#65292;&#23427;&#26368;&#22823;&#30340;&#22351;&#22788;&#23601;&#26159;&#21363;&#20351;&#19981;&#29992;continuation&#30340;&#31243;&#24207;&#25110;&#32773;&#19968;&#20010;&#31243;&#24207;&#20013;&#19981;&#29992;continuation&#30340;&#37096;&#20998;&#20063;&#35201;&#25918;&#24323;&#20256;&#32479;&#30340;stack&#25913;&#29992;heap&#65292;&#22240;&#27492;&#25928;&#29575;&#19978;&#20250;&#21463;&#21040;&#24433;&#21709;&#12290;&#22522;&#20110;stack&#30340;&#35299;&#20915;&#26041;&#26696;&#23601;&#27809;&#26377;&#36825;&#20010;&#38382;&#39064;&#12290;&#22312;&#22522;&#20110;stack&#30340;&#26041;&#26696;&#20013;&#65292;&#25105;&#20204;&#24179;&#24120;&#20173;&#28982;&#20351;&#29992;&#20256;&#32479;&#30340;stack&#65292;&#20854;&#20248;&#28857;&#26159;&#22914;&#26524;&#19981;&#20351;&#29992;continuation&#30340;&#35805;&#65292;&#31243;&#24207;&#36816;&#34892;&#23601;&#23436;&#20840;&#19981;&#29992;&#32771;&#34385;&#23545;continuation&#30340;&#25903;&#25345;&#12290;&#20854;&#32570;&#28857;&#26159;&#65292;&#27599;&#27425;&#25105;&#20204;&#33719;&#21462;&#19968;&#20010;continuation&#26102;&#65292;&#24403;&#21069;&#30340;stack&#24517;&#39035;&#25335;&#36125;&#19968;&#20221;&#65292;&#35813;&#25335;&#36125;&#25104;&#20026;continuation&#30340;&#19968;&#37096;&#20998;&#12290;&#35843;&#29992;continuation&#26102;&#65292;&#25105;&#20204;&#38656;&#35201;&#21024;&#38500;&#24403;&#21069;stack&#65292;&#28982;&#21518;&#25226;continuation&#37324;&#24102;&#30340;stack&#25335;&#36125;&#21464;&#25104;&#24403;&#21069;stack&#12290;&#30446;&#21069;&#22823;&#37096;&#20998;&#25903;&#25345;continuation&#30340;&#36816;&#34892;&#29615;&#22659;&#20351;&#29992;&#30340;&#26159;&#37117;&#26159;&#22522;&#20110;stack&#26041;&#26696;&#30340;&#19968;&#20123;&#21464;&#31181;&#12290;</p><p>&#22522;&#20110;stack&#21644;&#22522;&#20110;heap&#30340;&#23454;&#29616;&#21487;&#20197;&#30475;&#25104;&#20004;&#20010;&#26497;&#31471;&#24773;&#20917;&#65292;&#36824;&#26377;&#24456;&#22810;&#26041;&#27861;&#35797;&#22270;&#32467;&#21512;&#20004;&#32773;&#30340;&#20248;&#28857;&#65292;&#20197;&#25552;&#20379;&#26356;&#26377;&#25928;&#29575;&#30340;continuation&#25903;&#25345;&#12290;&#19981;&#36807;&#65292;&#25928;&#29575;&#21487;&#33021;&#24182;&#19981;&#26159;&#25105;&#20204;&#26368;&#20851;&#24515;&#30340;&#12290;&#25105;&#20204;&#29616;&#22312;&#30495;&#27491;&#20851;&#24515;&#30340;&#26159;&#65292;&#26377;&#27809;&#26377;&#21150;&#27861;&#22312;Java&#24179;&#21488;&#19978;&#23454;&#29616;continuation&#65311;</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch04s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;4.&nbsp;Continuation&#30340;&#23454;&#29616;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;2.&nbsp;&#22312;Java&#19978;&#23454;&#29616;Continuation&#65306;&#22522;&#20110;stack&#27861;</td></tr></table></div></body></html>